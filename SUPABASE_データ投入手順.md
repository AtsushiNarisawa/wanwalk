# 📋 Supabaseデータ投入手順

このガイドに従って、WanMap v2のテストデータを安全に投入してください。

---

## ステップ1: Supabase管理画面を開く

1. ブラウザで以下のURLを開く:
   ```
   https://supabase.com/dashboard/project/jkpenklhrlbctebkpvax
   ```

2. ログインしていない場合はログイン

3. 左側のメニューから **「SQL Editor」** をクリック

---

## ステップ2: データベース構造を確認（重要！）

**間違った場所にデータを投入しないために、まず現在のデータベース状態を確認します。**

### 実行手順:

1. SQL Editorの画面で **「New Query」** をクリック

2. 以下のファイルの内容をコピー&ペースト:
   ```
   VERIFY_DATABASE_STRUCTURE.sql
   ```
   
   ファイルの場所: プロジェクトのルートディレクトリ

3. **「Run」** ボタンをクリック（または Cmd+Enter / Ctrl+Enter）

4. 結果を確認:
   ```
   ✅ 確認すべきポイント:
   
   - areas テーブル: 
     → 「❌ データなし」と表示された場合: データ投入が必要
     → 「✅ データあり」と表示された場合: 既にデータが存在
   
   - official_routes テーブル:
     → 「❌ データなし」と表示された場合: データ投入が必要
     → 「✅ データあり」と表示された場合: 既にデータが存在
   
   - walk_photos テーブル:
     → 「✅ テーブル存在」と表示された場合: OK
     → 「❌ テーブル未作成」と表示された場合: Phase3写真機能が使えません
   
   - Storage Buckets:
     → walk-photos バケットがあるか確認
   ```

### 📸 スクリーンショット（参考）
実行すると、以下のような結果が表示されます:

```
section              | tablename           | schemaname
==================== | =================== | ==========
全テーブル一覧        | areas               | public
                     | official_routes     | public
                     | walks               | public
                     ...

section              | total_areas | status
==================== | =========== | ====================
areasテーブル         | 0           | ❌ データなし - 投入が必要
```

---

## ステップ3: テストデータを投入

### 実行手順:

1. SQL Editorで **「New Query」** をクリック（新しいタブを開く）

2. 以下のファイルの内容をコピー&ペースト:
   ```
   INSERT_TEST_DATA_SAFE.sql
   ```
   
   ファイルの場所: プロジェクトのルートディレクトリ

3. **「Run」** ボタンをクリック

4. 実行結果を確認:
   ```
   ✅ 成功メッセージの例:
   
   ========================================
   ✅ データ投入完了！
   ========================================
   投入後のデータ状況:
     - areas: 3 件
     - official_routes: 3 件
     - official_route_points: 4 件
   ========================================
   ```

### ⚠️ エラーが出た場合:

**エラー例1: `duplicate key value violates unique constraint`**
→ **問題なし**: データが既に存在するため、スキップされました

**エラー例2: `relation "areas" does not exist`**
→ **問題あり**: テーブルが作成されていません
→ 対処法: `supabase_migrations/002_create_new_tables.sql` を先に実行

**エラー例3: `function ST_SetSRID does not exist`**
→ **問題あり**: PostGIS拡張機能が有効化されていません
→ 対処法: SQL Editorで `CREATE EXTENSION IF NOT EXISTS postgis;` を実行

---

## ステップ4: データ投入の確認

### 投入されたデータ:

#### **エリア（3件）:**
- 📍 **箱根** - DogHub所在地（中心: 北緯35.2328, 東経139.1071）
- 📍 **横浜** - 将来の拡張用
- 📍 **鎌倉** - 将来の拡張用

#### **公式ルート（3件）:**

1. **DogHub周遊コース**
   - 難易度: 初心者向け (easy)
   - 距離: 約1.2km
   - 所要時間: 約20分
   - 経路ポイント: 4箇所

2. **箱根旧街道散歩道**
   - 難易度: 中級者向け (moderate)
   - 距離: 約3.5km
   - 所要時間: 約60分

3. **芦ノ湖畔ロングウォーク**
   - 難易度: 上級者向け (hard)
   - 距離: 約6.8km
   - 所要時間: 約120分

---

## ステップ5: アプリで確認

データ投入が完了したら、アプリで確認しましょう：

1. **アプリを起動**（またはホットリスタート）

2. **ホーム画面**で「**エリアを探す**」ボタンをタップ

3. **エリア一覧画面**で以下が表示されることを確認:
   - ✅ 箱根
   - ✅ 横浜
   - ✅ 鎌倉

4. **箱根**をタップ

5. **ルート一覧画面**で以下が表示されることを確認:
   - ✅ DogHub周遊コース（約1.2km / 20分）
   - ✅ 箱根旧街道散歩道（約3.5km / 60分）
   - ✅ 芦ノ湖畔ロングウォーク（約6.8km / 120分）

---

## 🎯 次のステップ

データ投入が完了したら、以下を実施してください：

### **Phase 3 写真機能のテスト準備:**

もし `walk_photos` テーブルが存在しない場合:

1. SQL Editorで **「New Query」** をクリック

2. 以下のファイルの内容をコピー&ペースト:
   ```
   database_migrations/005_walk_photos_table.sql
   ```

3. **「Run」** をクリック

4. 続けて、Storageバケット作成:
   ```
   database_migrations/007_walk_photos_storage_bucket.sql
   ```
   （※このファイルが存在しない場合は、手動でバケット作成が必要）

---

## ❓ トラブルシューティング

### Q1: SQL実行時にエラーが出る

**A:** エラーメッセージを確認してください。主なエラー:
- `duplicate key`: データが既に存在（問題なし）
- `relation does not exist`: テーブル未作成（マイグレーション002を実行）
- `function does not exist`: PostGIS拡張が無効（`CREATE EXTENSION postgis;`を実行）

### Q2: アプリでエリアが表示されない

**A:** 以下を確認:
1. データが正しく投入されたか（ステップ2で確認）
2. アプリを完全再起動したか（Hot Restartではなく、Stop → Run）
3. ネットワークエラーが出ていないか（Supabase接続確認）

### Q3: "エリアが登録されていません"と表示される

**A:** データ投入が失敗している可能性があります:
1. ステップ2（VERIFY_DATABASE_STRUCTURE.sql）を実行
2. areas テーブルにデータがあるか確認
3. なければ、ステップ3を再実行

---

## 📞 サポート

問題が解決しない場合は、以下の情報を共有してください：

1. VERIFY_DATABASE_STRUCTURE.sql の実行結果（スクリーンショット）
2. INSERT_TEST_DATA_SAFE.sql の実行時のエラーメッセージ
3. アプリのエラーログ（Xcodeのコンソール出力）

---

**作成日**: 2025-11-24
**対象バージョン**: WanMap v2 Phase 3
